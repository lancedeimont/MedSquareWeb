<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>MedSquare Web</title> 
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="http://get.goXTK.com/xtk.js"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
        
        <link rel="stylesheet" href="CSS/main.css">
        <link rel="stylesheet" href="CSS/normalize.css">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="dat.gui.js"> </script>
        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
        <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    </head>
    <body style="background-color: #000 ">
        <div style="background-color: #f0f0f0 ;width:100%"><button id="butOpen" >Open</button></div>
        
        <div style="float: left; width: 30%;height: 100%">
            <br/>
            <div id="axialSlice" style="height:33%; margin: 2px;border-right: solid yellow">axial</div>
            <div id="sagitalSlice" style="height:33%; margin: 2px; border-right: solid red">sagital</div>
            <div id="coronalSlice" style="height:33%; margin: 2px; border-right: solid green">coronal</div>      
        </div>
        <div id="3Dslice" style="float:left; width: 50%; height: 500px">            
            <br/>
        </div>
        
        <script> 
            window.onload = function() {

            //
            // try to create the 3D renderer
            //

            _webGLFriendly = true;
            try {
                // try to create and initialize a 3D renderer
                threeD = new X.renderer3D();
                threeD.container = '3Dslice';
                threeD.init();
            } catch (Exception) {

                // no webgl on this machine
                _webGLFriendly = false;

            }
            //
            // create the 2D renderers
            // .. for the X orientation
            sliceX = new X.renderer2D();
            sliceX.container = 'axialSlice';
            sliceX.orientation = 'Z';
            sliceX.init();
            // .. for Y
            sliceY = new X.renderer2D();
            sliceY.container = 'sagitalSlice';
            sliceY.orientation = 'X';
            sliceY.init();
            // .. and for Z
            sliceZ = new X.renderer2D();
            sliceZ.container = 'coronalSlice';
            sliceZ.orientation = 'Y';
            sliceZ.init();
            
            //
            // THE VOLUME DATA
            //
            // create a X.volume
            volume = new X.volume();
            volume.file = 'data/sivT1.nii';//'http://x.babymri.org/?vol.nrrd';
            
            sliceX.add(volume);
  
            // start the loading/rendering
            sliceX.render();
            
            //building the interfaces
            gui = new dat.GUI();


            
            //creating containers for the controls
            foldNavigation = gui.addFolder('Slice navigation');
            foldWinLevel= gui.addFolder('Window and level');
            foldOther=gui.addFolder('Processes');
            
            //slices controls
            guiAxial=foldNavigation.add(volume, 'indexZ',0,volume.dimensions[2]-1).name('axial');
            guiSagital=foldNavigation.add(volume, 'indexX',0,volume.dimensions[0]-1).name('sagital');
            guiCoronal=foldNavigation.add(volume, 'indexY',0,volume.dimensions[1]-1).name('coronal');
            
            // .. configure the volume rendering opacity
            guiOpacityController = foldOther.add(volume, 'opacity', 0, 1);
              
            guiVolumeController = foldOther.add(volume, 'volumeRendering');
            
            //controls for the window and level
            guiLowerThresholdController = foldWinLevel.add(volume, 'lowerThreshold',
                volume.min, volume.max);
            guiUpperThresholdController = foldWinLevel.add(volume, 'upperThreshold',
                volume.min, volume.max);
            guiLowerWindowController = foldWinLevel.add(volume, 'windowLow', volume.min,
                volume.max);
            guiUpperWindowController = foldWinLevel.add(volume, 'windowHigh', volume.min,
                volume.max);
                
            foldNavigation.open();
            foldWinLevel.open();
            foldOther.open();
            
            // the onShowtime method gets executed after all files were fully loaded and
            // just before the first rendering attempt
            sliceX.onShowtime = function() {
                //
                // add the volume to the other 3 renderers
                //
                sliceY.add(volume);
                sliceY.render();
                sliceZ.add(volume);
                sliceZ.render();

                if (_webGLFriendly) {
                  threeD.add(volume);
                  threeD.render();
                }  
                updateGUI();                
            }; 
            function updateGUI(){
                //setting max values to the index of slices and the current index
                guiAxial.max(volume.dimensions[2]-1).setValue(volume.indexZ);
                guiSagital.max(volume.dimensions[0]-1).setValue(volume.indexX);
                guiCoronal.max(volume.dimensions[1]-1).setValue(volume.indexY);
                
                var minv=volume.min;
                var maxv=volume.max;
                //setting the max and min values for the window level controls
                guiLowerThresholdController.min(minv).max(maxv).setValue(minv);
                guiUpperThresholdController.min(minv).max(maxv).setValue(maxv);
                guiLowerWindowController.min(minv).max(maxv).setValue(minv);
                guiUpperWindowController.min(minv).max(maxv).setValue(maxv);
            }
            };
            
            </script>
    </body>
</html>
